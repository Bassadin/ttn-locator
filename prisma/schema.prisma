generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model ttnmapper_datapoint {
    id                      Int                  @id
    timestamp               DateTime
    device_gps_datapoint    device_gps_datapoint @relation(fields: [device_gps_datapoint_id], references: [id])
    device_gps_datapoint_id Int
    gateway                 gateway              @relation(fields: [gateway_id], references: [gateway_id])
    gateway_id              String
    rssi                    Int
    snr                     Float
}

model device_gps_datapoint {
    id                  Int                   @id @default(autoincrement())
    timestamp           DateTime
    device              device                @relation(fields: [device_dev_id], references: [device_id])
    device_dev_id       String
    latitude            Float
    longitude           Float
    altitude            Float
    hdop                Float
    ttnmapper_datapoint ttnmapper_datapoint[]
}

model device {
    device_id             String                 @id
    device_gps_datapoints device_gps_datapoint[]
    device_subscription   device_subscription?
    created_at            DateTime               @default(now())
    updated_at            DateTime               @updatedAt
}

model gateway {
    gateway_id           String                @id
    latitude             Float
    longitude            Float
    ttnmapper_datapoints ttnmapper_datapoint[]
    created_at           DateTime              @default(now())
    updated_at           DateTime              @updatedAt
}

// add a model that represents subscriptions to device IDs
model device_subscription {
    device_id  String   @id @unique
    device     device   @relation(fields: [device_id], references: [device_id])
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt
}
